<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>地图热力图-稳定版</title>
    <script src="https://lib.baomitu.com/echarts/5.4.3/echarts.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #00050a; }
        #main { width: 100%; height: 100%; }
        /* 增加一个加载提示，如果一直显示这个，说明地图数据没拉下来 */
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #1a73e8; font-family: sans-serif; z-index: 100;
        }
    </style>
</head>
<body>
    <div id="loading">地图数据加载中，请稍候...</div>
    <div id="main"></div>
    <script>
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        
        // 这里放入你之前的 mapData 变量（我已经在后台为你重新打包好了）
        var mapData = [/* 数据会自动注入 */]; 

        // 尝试从备用地址获取地图
        fetch('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json')
            .then(response => {
                if (!response.ok) throw new Error('网络响应不正常');
                return response.json();
            })
            .then(chinaJson => {
                document.getElementById('loading').style.display = 'none';
                echarts.registerMap('china', chinaJson);
                
                var option = {
                    backgroundColor: '#00050a',
                    tooltip: {
                        trigger: 'item',
                        backgroundColor: 'rgba(10, 20, 30, 0.9)',
                        formatter: function (params) {
                            return params.data && params.data.info ? params.data.info : "";
                        }
                    },
                    visualMap: {
                        min: 0.65, max: 1.00, precision: 2,
                        calculable: true, left: '5%', bottom: '5%',
                        inRange: { color: ['#1e3a8a', '#3b82f6', '#fbbf24', '#ef4444'] },
                        textStyle: { color: '#fff' }
                    },
                    geo: {
                        map: 'china', roam: true, zoom: 1.2,
                        label: { show: false, emphasis: { show: false } },
                        itemStyle: {
                            normal: { areaColor: '#0a1120', borderColor: '#1e293b', borderWidth: 0.5 },
                            emphasis: { areaColor: '#0f172a' }
                        }
                    },
                    series: [
                        {
                            type: 'heatmap', coordinateSystem: 'geo',
                            data: mapData, pointSize: 25, blurSize: 30
                        },
                        {
                            type: 'scatter', coordinateSystem: 'geo',
                            data: mapData, symbolSize: 20,
                            itemStyle: { color: 'transparent' }
                        }
                    ]
                };
                myChart.setOption(option);
            })
            .catch(error => {
                document.getElementById('loading').innerText = '加载失败，请检查网络或刷新页面。';
                console.error('地图加载错误:', error);
            });

        window.addEventListener('resize', function() { myChart.resize(); });
    </script>
</body>
</html>
